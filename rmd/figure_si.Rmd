---
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      message = FALSE,
                      warning = FALSE)
```

```{r figure-sim, include=FALSE}

library(tidyverse)

df_grt <- readRDS(here::here("data_fmt/sim_fcl_si.rds")) %>%
  distinct(g, rho, theta, h, delta0, z)

title_text <- with(df_grt,
                   paste0("## Numerical prediction (",
                          ifelse(g == max(g), "high propagule, ", "low propagule, "),
                          ifelse(rho == max(rho), "high synchrony, ", "low synchrony, "),
                          ifelse(theta == max(theta), "strong omnivory", "weak omnivory"),
                          ") {-}\n\n"))

c_text <- "Heatmap of FCL as a function of ecosystem size (river length, $L$)
and complexity (branching rate, $\\lambda_b$), with rows and columns displaying
different combinations of resource supply ($r_0$), disturbance regime
($\\mu^{(0)}$), predation effect ($\\mu^{(c)}$), and prey effect ($\\mu^{(p)}$).
Each cell represents the average FCL of five food webs.
Additional parameter values are: "

cap <- with(df_grt,
            paste0(c_text,
                   "number of gross propagules $g_0=", g, "$, ",
                   "synchrony probability $\\rho=", rho, "$, ",
                   "omnivory $\\theta=", theta, "$, ",
                   "habitat density $h=", h, "$, ",
                   "dispersal capability $\\delta_0=", delta0, "$, and ",
                   "scaling exponent $\\psi_1=\\psi_2=", z, "$."))

pdf <- with(df_grt,
            paste0("data_fmt/",
                   "fig_rho", rho,
                   "_g", g,
                   "_theta", theta) %>%
              str_remove_all("\\.")) %>%
  paste0(".pdf")

figure_sim_chunk <- knit_chunk <- NULL

for(i in seq_len(nrow(df_grt))) {

  knit_chunk <- paste0(title_text[i],
                       "```{r fig-sim", i, ", fig.aligh='center', fig.cap=cap[",i,"]}\n",
                       "\nknitr::include_graphics(here::here(pdf[", i, "]))\n",
                       "```\n",
                       "\n\\newpage\n")

  figure_sim_chunk <- c(figure_sim_chunk, knit_chunk)

}

```

`r paste(knitr::knit(text = figure_sim_chunk), collapse = '\n')`
